(()=>{"use strict";function c(t,n){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,n){if(t){if("string"==typeof t)return i(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(r="Object"===r&&t.constructor?t.constructor.name:r)||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(t,n):void 0}}(t))||n&&t&&"number"==typeof t.length){r&&(t=r);var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,a=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return c=t.done,t},e:function(t){a=!0,o=t},f:function(){try{c||null==r.return||r.return()}finally{if(a)throw o}}}}function i(t,n){(null==n||n>t.length)&&(n=t.length);for(var r=0,e=new Array(n);r<n;r++)e[r]=t[r];return e}function a(t,n){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,n){if(t){if("string"==typeof t)return u(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(r="Object"===r&&t.constructor?t.constructor.name:r)||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(t,n):void 0}}(t))||n&&t&&"number"==typeof t.length){r&&(t=r);var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,a=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return c=t.done,t},e:function(t){a=!0,o=t},f:function(){try{c||null==r.return||r.return()}finally{if(a)throw o}}}}function u(t,n){(null==n||n>t.length)&&(n=t.length);for(var r=0,e=new Array(n);r<n;r++)e[r]=t[r];return e}new Vue({el:"#app",components:{cart:{components:{cartItem:{props:["cartItem"],template:'\n                <div class="cart-item">\n                    <div class="product-bio">\n                        <img :src="cartItem.img_cart" alt="Some img">\n                        <div class="product-desc">\n                            <p class="product-title">{{cartItem.product_name}}</p>\n                            <p class="product-quantity">Количество: {{cartItem.quantity}}</p>\n                            <p class="product-single-price">{{cartItem.price}} ₽ за единицу</p>\n                        </div>\n                    </div>\n                    <div class="right-block">\n                        <p class="product-price">{{cartItem.price * cartItem.quantity}} ₽</p>\n                        <button class="del-btn" @click="$emit(\'remove\', cartItem)">X</button>\n                    </div>\n                </div>'}},data:function(){return{cartItems:[],showCart:!1}},methods:{addProduct:function(n){var r,e=this,t=this.cartItems.find(function(t){return t.id_product===n.id_product});t?(this.$parent.putJson("/api/cart/".concat(t.id_product),{quantity:1,product_name:"".concat(n.product_name)}),t.quantity++):(r=Object.assign({quantity:1},n),this.$parent.postJson("/api/cart",r).then(function(t){1===t.result&&e.cartItems.push(r)}))},remove:function(t){1<t.quantity?(this.$parent.putJson("/api/cart/".concat(t.id_product),{quantity:-1,product_name:"".concat(t.product_name)}),t.quantity--):(this.$parent.removeJson("/api/cart/".concat(t.id_product),{product_name:"".concat(t.product_name)}),this.cartItems.splice(this.cartItems.indexOf(t),1))}},mounted:function(){var o=this;this.$parent.getJson("/api/cart").then(function(t){var n,r=c(t.contents);try{for(r.s();!(n=r.n()).done;){var e=n.value;o.cartItems.push(e)}}catch(t){r.e(t)}finally{r.f()}})},template:'\n                <div>\n                    <button class="btn-cart" type="button" @click="showCart = !showCart">Корзина</button>\n                    <div class="cart-block" v-show="showCart">\n                        <p v-if="!cartItems.length">Корзина пуста</p>\n                        <cart-item class="cart-item"\n                        v-for="item of cartItems"\n                        :key="item.id_product"\n                        :cart-item="item"\n                        @remove="remove">\n                        </cart-item>\n                    </div>\n                </div>'},products:{components:{product:{props:["product"],data:function(){return{cartAPI:this.$root.$refs.cart}},template:'\n        <div class="product-item">\n            <img :src="product.img_catalog" alt="Some img">\n            <div class="desk">\n                <h3>{{product.product_name}}</h3>\n                <p>{{product.price}} ₽</p>\n                <button class="buy-btn" @click="cartAPI.addProduct(product)">Купить</button>\n            </div>\n        </div>\n    '}},data:function(){return{products:[],filtered:[]}},methods:{filter:function(t){var n=new RegExp(t,"i");this.filtered=this.products.filter(function(t){return n.test(t.product_name)})}},mounted:function(){var o=this;this.$parent.getJson("/api/products").then(function(t){var n,r=a(t);try{for(r.s();!(n=r.n()).done;){var e=n.value;o.products.push(e),o.filtered.push(e)}}catch(t){r.e(t)}finally{r.f()}})},template:'\n        <div class="products">\n            <product v-for="item of filtered" :key="item.id_product" :product="item"></product>\n        </div>\n    '},error:{data:function(){return{error:""}},template:'\n        <div class="error">{{ error }}</div>\n    '},search:{data:function(){return{userSearch:""}},template:'\n    <div>\n            <form action="#" class="search-form" @submit.prevent="$parent.$refs.products.filter(userSearch)">\n                    <input type="text" class="search-field" v-model="userSearch">\n                    <button class="btn-search" type="submit">\n                    <i class="fa fa-search fa-lg" aria-hidden="true"></i>\n                    </button>\n            </form>\n    </div>\n'}},methods:{getJson:function(t){var n=this;return fetch(t).then(function(t){return t.json()}).catch(function(t){n.$refs.error.error=t})},postJson:function(t,n){var r=this;return fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then(function(t){return t.json()}).catch(function(t){r.$refs.error.error=t})},putJson:function(t,n){var r=this;return fetch(t,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then(function(t){return t.json()}).catch(function(t){r.$refs.error.error=t})},removeJson:function(t,n){var r=this;return fetch(t,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then(function(t){return t.json()}).catch(function(t){r.$refs.error.error=t})}},mounted:function(){console.log(this)}})})();
//# sourceMappingURL=script.js.map